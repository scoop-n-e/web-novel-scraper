# なろうR18小説API

## 概要

なろうR18小説APIではノクターンノベルズ、ムーンライトノベルズおよびミッドナイトノベルズに掲載されている18歳未満閲覧禁止のR18作品情報を取得できます。

**重要:** このページで取り扱う情報には、18歳未満が取り扱うのにふさわしくない情報が含まれています。
本APIで取得した情報を18歳未満に閲覧させてはいけません。

なろうR18小説APIはHTTPでのリクエストに対してJSON形式、JSONP形式、YAML形式またはPHPの`serialize`で応答します。
実際に作品のデータが修正されてからなろうAPIに反映されるまで平均5分程度(最大2時間)の誤差があります。

**注意: APIを使うためにはJavaScriptあるいはPerl/PHP/Ruby/Java/C言語などでプログラミングが必要です。**

## 出力形式

- JSON形式、JSONP形式またはYAML形式、PHPの`serialize`
- 標準はYAML形式となっていますが、`out`パラメータで変更できます
- 文字コードはUTF-8です

## APIのURL

```
https://api.syosetu.com/novel18api/api/
```

- GETで送信。POSTでは受信できません
- 日本語などマルチバイト文字送信時は文字コードをUTF-8にし、URLエンコードしてください

## 出力GETパラメータ

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `gzip` | int(1～5) | gzip圧縮してgzipファイルとして返します。<br>gzip圧縮レベルを`1～5`で指定できます。<br>転送量上限を減らすためにも推奨 |
| `out` | string | 出力形式をyamlまたはjsonまたはphpを指定。<br>未指定時はYAMLになる。[outパラメータの詳細](#outパラメータの詳細) |
| `of` | string | 出力する項目を個別に指定できます。未指定時は全項目出力されます。<br>転送量軽減のため、このパラメータの使用が推奨されます。<br>複数項目を出力する場合は-で区切ってください。詳しくは[出力](#出力)の項目をご覧ください。 |
| `lim` | int(1～500) | 最大出力数を指定できます。最低`1`、最高`500`です。<br>半角数字で指定してください。<br>指定しない場合は20件になります。 |
| `st` | int(1～2000) | 表示開始位置の指定です。半角数字で指定してください。<br>たとえば全部で10作品あるとして、3作品目以降の作品情報を取得したい場合は`3`と指定してください。 |
| `order` | string | 出力順序を指定できます。<br>指定しない場合は新着更新順となります。<br><br>指定可能な値:<br>• `new` - 新着更新順<br>• `favnovelcnt` - R18ブックマーク数の多い順<br>• `reviewcnt` - レビュー数の多い順<br>• `hyoka` - 総合ポイントの高い順<br>• `hyokacnt` - 評価者数の多い順<br>• `lengthdesc` - 作品本文の文字数が多い順<br>• `dailypoint` - 日間ポイントの高い順<br>• `weeklypoint` - 週間ポイントの高い順<br>• `monthlypoint` - 月間ポイントの高い順<br>• `quarterpoint` - 四半期ポイントの高い順<br>• `yearlypoint` - 年間ポイントの高い順<br>• `weekly` - 週間ユニークユーザの多い順（毎週水曜日早朝リセット、前週の日曜日から土曜日分）<br>• `lengthasc` - 作品本文の文字数が少ない順<br>• `old` - 更新が古い順 |

## outパラメータの詳細

出力形式を指定できます。
jsonまたはyamlまたはphpで指定してください。

| 値 | 説明 |
|----|------|
| `yaml` | YAML形式(デフォルト) |
| `json` | JSON形式 |
| `php` | PHPの`serialize()` |
| `atom` | Atomフィード |
| `jsonp` | JSONP形式 |

### JSONPの使い方

JSONPを利用することでJavaScriptから直接、APIを利用できるようになります。

| パラメータ | 説明 |
|-----------|------|
| `callback` | コールバック関数名。コールバック関数名には半角英数字など`/^$?[a-zA-Z0-9\[\]\.\_]+$/` (perl) の正規表現に一致する関数名を指定してください。 |

**例:**
```
https://api.syosetu.com/novel18api/api/?out=jsonp&callback=call
```
JSONP形式でコールバック関数名を`call`にしたい場合のURLです。

### YAML形式の出力に関する動作について

出力形式にYAMLを指定した場合、パラメータを指定する事で利用するライブラリを変更できます。

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `libtype` | int | 利用するライブラリを指定できます。<br>未指定もしくは`1`以下の値を指定した場合、従来通りのライブラリを利用します。<br>`2`以上の値を指定すると、新ライブラリを利用します。<br>新ライブラリでは以下の点が従来のライブラリと異なります。<br>• 文字列と数値の型指定が厳格化します。<br>• マルチバイト文字や一部の制御文字がエスケープ処理されます。 |

**例:**
```
https://api.syosetu.com/novel18api/api/?libtype=1
```
従来通りのライブラリで出力を行ないます。
作品名や作者名等、文字列が格納されるエピソードが数値で構成されている場合でも、数値はダブルクォートで囲まれません。

```
https://api.syosetu.com/novel18api/api/?libtype=2
```
新ライブラリで出力を行ないます。
作品名や作者名等、文字列が格納されるエピソードが数値で構成されている場合、数値がダブルクォートで囲まれます。

### Atomフィード形式の出力に関する動作について

Atomフィードの出力内容をパラメータを指定することで変更できます。

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `updatetype` | int | 日付として出力する項目を指定できます。<br>`2`の値を指定すると、最終掲載日`general_lastup`を日付として出力します。<br>未指定の場合、作品の更新日時`novelupdated_at`を日付として出力します。 |

**例:**
```
https://api.syosetu.com/novel18api/api/?out=atom
```
作品の更新日時`novelupdated_at`を日付として出力します。

```
https://api.syosetu.com/novel18api/api/?out=atom&updatetype=2
```
最終掲載日`general_lastup`を日付として出力します。

## 条件抽出GETパラメータ

### 検索単語指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `word` | string | 単語を指定できます。文字コードはUTF-8でURLエンコードしてください。<br>半角または全角スペースで区切るとAND抽出になります。部分一致でHITします。 |
| `notword` | string | 含みたくない単語を指定できます。文字コードはUTF-8でURLエンコードしてください。<br>スペースで区切ることにより含ませない単語を増やせます。部分一致で除外されます。 |

### 抽出対象の範囲

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `title` | int | `1`の場合はタイトルを`word`と`notword`の抽出対象にします。 |
| `ex` | int | `1`の場合はあらすじを`word`と`notword`の抽出対象にします。 |
| `keyword` | int | `1`の場合はキーワードを`word`と`notword`の抽出対象にします。 |
| `wname` | int | `1`の場合は作者名を`word`と`notword`の抽出対象にします。 |

**注意:** 上記4項目すべて指定しない場合は全項目抽出対象と扱います。
`word`がNコードと判断される文字列の場合、抽出対象はすべて無視され、Nコードから作品を探します。

### 掲載サイト指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `nocgenre` | int/string | 掲載サイトを指定できます。ハイフン(-)記号で区切れば複数の掲載サイトを一括抽出できます。<br><br>指定可能な値:<br>• `1` - ノクターンノベルズ(男性向け)<br>• `2` - ムーンライトノベルズ(女性向け)<br>• `3` - ムーンライトノベルズ(BL)<br>• `4` - ミッドナイトノベルズ(大人向け) |

**例:**
```
https://api.syosetu.com/novel18api/api/?nocgenre=1
```
掲載サイトがノクターンノベルズ(男性向け)となっている作品の作品情報を取得するURLです。

```
https://api.syosetu.com/novel18api/api/?nocgenre=1-3
```
掲載サイトがノクターンノベルズ(男性向け)またはムーンライトノベルズ(BL)となっている作品の作品情報を取得するURLです。

### 掲載サイト除外指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `notnocgenre` | int/string | 掲載サイトを除外検索できます。ハイフン(-)記号で区切れば含ませたくない掲載サイトを増やせます。<br>指定可能な値は`nocgenre`パラメータと同じです。 |

**例:**
```
https://api.syosetu.com/novel18api/api/?notnocgenre=1
```
掲載サイトがノクターンノベルズ(男性向け)となっている作品以外の作品情報を取得するURLです。

```
https://api.syosetu.com/novel18api/api/?notnocgenre=2-3
```
掲載サイトがムーンライトノベルズ(女性向け、BL)となっている作品以外の作品情報を取得するURLです。

### ユーザID指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `userid` | int/string | ユーザIDで抽出可能。ハイフン(-)記号で区切ればユーザIDのOR検索ができます。 |

### 作品種別指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `type` | int | 作品種別を指定できます。<br>• `1` - 短編<br>• `2` - 連載中<br>• `3` - 完結済 |

### 文字数範囲指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `minlen` | int | 作品本文の文字数下限を指定します。 |
| `maxlen` | int | 作品本文の文字数上限を指定します。 |

### 時間範囲指定

| パラメータ | 値 | 説明 |
|------------|----|----- |
| `lastup` | string | 最終掲載日を指定します。YYYY-MM-DD形式またはYYYY-MM-DD-YYYY-MM-DD形式で指定可能。 |
| `firstup` | string | 初回掲載日を指定します。YYYY-MM-DD形式またはYYYY-MM-DD-YYYY-MM-DD形式で指定可能。 |

## 出力

APIサーバが出力する文字コードはUTF-8です。デフォルトはYAML形式です。
outパラメータでJSON形式などにも変更できます。
最初の要素には全作品情報出力数が入り、以降、一作品ずつ情報が入っています。

### 主要な出力項目

| 要素 | 値 | 説明 |
|------|----|----- |
| `allcount` | int | 全作品情報出力数 |
| `title` | string | 作品名 |
| `ncode` | string | Nコード |
| `userid` | int | 作者のユーザID |
| `writer` | string | 作者名 |
| `story` | string | あらすじ |
| `nocgenre` | int | 掲載サイト |
| `keyword` | string | キーワード |
| `general_firstup` | string | 初回掲載日 |
| `general_lastup` | string | 最終掲載日 |
| `noveltype` | int | 作品種別（1:短編 2:連載中 3:完結済） |
| `end` | int | 短編かどうか（0:連載 1:短編） |
| `general_all_no` | int | 掲載話数 |
| `length` | int | 作品本文の文字数 |
| `time` | int | 読了時間（分） |
| `isstop` | int | 長期連載停止中かどうか（0:停止していない 1:停止中） |
| `pc_or_k` | int | 投稿端末（1:ケータイ 2:PC 3:スマホ） |
| `global_point` | int | 総合評価ポイント |
| `daily_point` | int | 日間ポイント |
| `weekly_point` | int | 週間ポイント |
| `monthly_point` | int | 月間ポイント |
| `quarter_point` | int | 四半期ポイント |
| `yearly_point` | int | 年間ポイント |
| `fav_novel_cnt` | int | R18ブックマーク数 |
| `impression_cnt` | int | 感想数 |
| `review_cnt` | int | レビュー数 |
| `all_point` | int | 評価点 |
| `all_hyoka_cnt` | int | 評価者数 |
| `sasie_cnt` | int | 挿絵の数 |
| `kaiwaritu` | int | 会話率 |
| `novelupdated_at` | string | 小説の更新日時 |
| `updated_at` | string | 最終更新日時 |

## 利用制限

**注意: 利用制限は現在、休止しています。**
負荷状況により今後、導入されることがあるためキャッシュの導入など、利用制限を想定したシステム設計をお願いします。ただし、古い情報を誤って掲載しないよう一定期間(長くても２週間)でキャッシュの更新・削除をお願いします。

IPアドレスごとに利用制限を行います。
1日の利用上限は80,000または転送量上限400MByteです。
利用制限は初回アクセスから24時間が適用範囲です。
初回のアクセスから24時間後に回数と転送量を記録していたカウンタと初回アクセス時刻をリセットします。
なお、1日の利用上限を超えた場合、エラーの発生確率が増します。
混雑状況にもよりますが、リクエスト回数または転送量が利用上限の120%を超えるとほとんど接続できなくなります。

備考：利用制限カウンタは厳密ではなく多少のマージンを設けてあります。
転送量は圧縮することで減らせます。

### 転送量制限の回避方法

- `gzip=5`を指定し、gzipファイルで受信する。
  デメリットとして受け取り側で解凍する手間は発生するが、かなりの転送量を削減できる。
- YAML形式を使う。一番容量が小さいため。
- `of`パラメータを使い、必要な項目のみを出力する。

## 遅延について

データベースサーバは日本国内の複数拠点に分散されていることがあります。
APIから小説データベースに接続した場合、原則としてスレーブサーバにつながります。
マスタサーバとスレーブサーバ間は10秒以内にデータを同期しています。

しかし、何らかのネットワーク障害が発生した場合、遅延が発生し、サーバによってデータにばらつきが生じることがあります。
また、実際に作品のデータが修正されてからなろうAPIに反映されるまで平均5分程度(最大2時間)の誤差があります。